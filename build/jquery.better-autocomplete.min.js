/*
 Better Autocomplete v1.0-dev
 https://github.com/betamos/Better-Autocomplete

 Copyright 2011, Didrik NordstrÃ¶m, http://betamos.se/
 Dual licensed under the MIT or GPL Version 2 licenses.

 Requires jQuery 1.4+
 http://jquery.com/
*/
(function(c){c.fn.betterAutocomplete=function(a){var b={init:function(a,b,d){var i=c(this),a=new j(i,a,b,d);i.data("better-autocomplete",a);a.enable()},enable:function(a){a.enable()},disable:function(a){a.disable()},destroy:function(a){a.destroy()}},d=Array.prototype.slice.call(arguments,1);this.each(function(){switch(a){case "init":b[a].apply(this,d);break;case "enable":case "disable":case "destroy":var f=c(this).data("better-autocomplete");f instanceof j&&b[a].call(this,f);break;default:c.error(["Method",
a,"does not exist in jQuery.betterAutocomplete."].join(" "))}});return this};var j=function(a,b,d,f){function v(){var k=f.canonicalQuery(a.val(),d.caseSensitive);clearTimeout(o);o=null;l();k.length>=d.charLimit&&!c.isArray(i[k])&&c.inArray(k,m)==-1&&(e.empty(),p?w(k):o=setTimeout(function(){w(k);o=null},d.delay))}var g="",i={},q=[],r=0,o,m=[],s=!1,h={},p=c.type(b)!="string",e=c("<ul />").addClass("better-autocomplete"),d=c.extend({charLimit:p?1:3,delay:350,caseSensitive:!1,cacheLimit:p?0:256,remoteTimeout:1E4,
crossOrigin:!1,selectKeys:[9,13]},d),f=c.extend({},x,f);f.insertSuggestionList(e,a,d.maxHeight);h.focus=function(){l(!0)};h.blur=function(){l()};h.keydown=function(a){var b=t();if(c.inArray(a.keyCode,[38,40])>=0&&b>=0){var f,y=c(".result",e).length;switch(a.keyCode){case 38:f=Math.max(0,b-1);break;case 40:f=Math.min(y-1,b+1)}s=!0;u(f,!0);return!1}else if(c.inArray(a.keyCode,d.selectKeys)>=0&&!a.shiftKey&&!a.ctrlKey&&!a.altKey&&!a.metaKey)return n(),a.keyCode==9};h.keyup=h.click=v;c(".result",e[0]).live({mouseover:function(){s||
u(c(".result",e).index(c(this)))},mousemove:function(){s=!1},mousedown:function(){n();return!1}});e.mousedown(function(){return!1});this.enable=function(){a.attr("autocomplete","OFF").attr("aria-autocomplete","list");a.bind(h)};this.disable=function(){a.removeAttr("autocomplete").removeAttr("aria-autocomplete");e.hide();a.unbind(h)};this.destroy=function(){e.remove();a.unbind(h);a.removeData("better-autocomplete")};var j=function(a,c){for(r+=c.length;r>d.cacheLimit&&q.length;){var b=q.shift();r-=
i[b].length;delete i[b]}q.push(a);i[a]=c},u=function(a,b){var f=a==0||a<t(),d=c(".result",e).removeClass("highlight").eq(a).addClass("highlight");b&&(d.prev().is(".group")&&f&&(d=d.prev()),d.position().top<0?e.scrollTop(d.position().top+e.scrollTop()):d.position().top+d.outerHeight()>e.height()&&e.scrollTop(d.position().top+e.scrollTop()+d.outerHeight()-e.height()))},t=function(){return c(".result",e).index(c(".result.highlight",e))},n=function(){var b=c(".result",e).eq(t());b.length&&(b=b.data("result"),
f.select(b,a),v())},w=function(e){if(p)j(e,f.queryLocalResults(e,b,d.caseSensitive)),l();else{m.push(e);var g=f.constructURL(b,e);f.beginFetching(a);f.fetchRemoteData(g,function(b){b=f.processRemoteData(b);c.isArray(b)||(b=[]);j(e,b);m=c.grep(m,function(a){return a!=e});m.length||f.finishFetching(a);l()},d.remoteTimeout,d.crossOrigin)}},l=function(b){var h=f.canonicalQuery(a.val(),d.caseSensitive);c.isArray(i[h])?g!==h&&(g=h,z(i[h]),u(0)):(g=null,e.empty());(a.is(":focus")||b)&&!e.is(":empty")?e.filter(":hidden").show().scrollTop(e.data("scroll-top")):
e.is(":visible")&&e.data("scroll-top",e.scrollTop()).hide()},z=function(a){e.empty();var b={};c.each(a,function(a,d){if(c.type(d)=="object"){var g=f.themeResult(d);if(c.type(g)=="string"){var h=f.getGroup(d);if(c.type(h)=="string"&&!b[h]){var i=c("<li />").addClass("group").append(c("<h3 />").html(h)).appendTo(e);b[h]=i}g=c("<li />").addClass("result").append(g).data("result",d).addClass(d.addClass);c.type(h)!="string"&&!e.children().first().is(".result")?e.prepend(g):(h=c.type(h)=="string"?b[h]:
e.children().first(),i=h.nextUntil(".group").last(),g.insertAfter(i.length?i:h))}}})}},x={select:function(a,b){b.val(a.title)},themeResult:function(a){var b=[];c.type(a.title)=="string"&&b.push("<h4>",a.title,"</h4>");c.type(a.description)=="string"&&b.push("<p>",a.description,"</p>");return b.join("")},queryLocalResults:function(a,b,d){if(!c.isArray(b))return[];var f=[];c.each(b,function(b,g){switch(c.type(g)){case "string":(d?g:g.toLowerCase()).indexOf(a)>=0&&f.push({title:g});break;case "object":c.type(g.title)==
"string"&&(d?g.title:g.title.toLowerCase()).indexOf(a)>=0?f.push(g):c.type(g.description)=="string"&&(d?g.description:g.description.toLowerCase()).indexOf(a)>=0&&f.push(g)}});return f},fetchRemoteData:function(a,b,d,f){c.ajax({url:a,dataType:f&&!c.support.cors?"jsonp":"json",timeout:d,success:function(a){b(a)},error:function(){b()}})},processRemoteData:function(a){return c.isArray(a)?a:[]},getGroup:function(a){if(c.type(a.group)=="string")return a.group},beginFetching:function(a){a.addClass("fetching")},
finishFetching:function(a){a.removeClass("fetching")},constructURL:function(a,b){return a+"?q="+encodeURIComponent(b)},canonicalQuery:function(a,b){var d=c.trim(a);b||(d=d.toLowerCase());return d},insertSuggestionList:function(a,b){a.width(b.outerWidth()-2).css({position:"absolute",left:b.position().left,top:b.position().top+b.outerHeight(),zIndex:10,maxHeight:"330px",boxShadow:"0 0 15px rgba(0, 0, 0, 0.5)"}).insertAfter(b)}},n=c.expr[":"];if(!n.focus)n.focus=function(a){return a===document.activeElement&&
(a.type||a.href)}})(jQuery);
